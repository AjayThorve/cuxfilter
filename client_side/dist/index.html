<!Doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>User Application</title>

        <style>
            html,body{
                margin: 0;
                padding: 0;
                font-size: 14px;
                font-family: sans-serif;
                color: #111;
                background-color: #eee;
                display: flex;
                justify-content: center;
                align-items: center;
            }
        </style>
    </head>
    <body>
        <div>
            <button id="filter_data"> filter_data</button>
            <button id="get_size"> get_size</button>
            <button id="load_dimension"> load_dimension</button>

            <button id="end_session"> end session </button>
        </div>
        <div id="app"></div>

    <script type="text/javascript" src="index.js"></script></body>

    <script>
        var elem = document.getElementById('app');
        var filter_data = document.getElementById('filter_data');
        var size = document.getElementById('get_size');
        var end_session = document.getElementById('end_session');
        var dimension_elem = document.getElementById('load_dimension');
        
        let dimension,group;

        let myData = new cuXfilter('predictions-v1','http://10.33.227.184:3003','cudf',true,'arrow');
        
        myData.init().then((status) => { //optional callback --> myData.init() also works
            display(status);
            display(myData.size);
            console.log(myData.schema);
            dimension = myData.dimension('zip');
            return dimension.loadDimension();
        }).then((error,message) => {
        
            console.log(message);
        
            dimension.getHist();
            const params = { 
							'delinquency_12_prediction': ['mean'], 
							'current_actual_upb': ['sum']
                            };
            group = dimension.group(params)
            
            dimension.top(100);

            return group.loadGroup();

        }).then(() =>{
            group.all();
        });
        
        
        addEventListener('updateHistEvent', (e) => {
            console.log("event update ", e.detail.column);
            console.log(dimension.histogram);
            alert('updated histogram received');
        });

        addEventListener('updateGroupEvent', (e) => {
            console.log("event update ", e.detail.column, e.detail.aggregate);
            console.log(group.value);
            alert('updated groupby received');
        });

        addEventListener('updateDimensionEvent', (e) => {
            console.log("event update ", e.detail.column);
            console.log(dimension.value);
            alert('updated dimension value received');
        });

        filter_data.onclick = function(){
            dimension.filter(739.0);
        }
        size.onclick = function(){
            console.log("the size of the dataset is "+myData.size);
            display('The size of the dataset is '+myData.size);
        }

        end_session.onclick = function(){
            myData.endSession();
        }

        function display(message){
            var temp = document.createElement('div');
            temp.innerHTML = message;
            elem.appendChild(temp);
        }

        
    </script>
</html>